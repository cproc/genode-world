genode.patch

From: Christian Prochaska <christian.prochaska@genode-labs.com>


---
 falkon.pro                          |   22 +++---
 src/config.h                        |   11 +++
 src/defines.pri                     |   23 ++++--
 src/lib/app/commandlineoptions.cpp  |    4 +
 src/lib/app/mainapplication.cpp     |   10 ++-
 src/lib/app/qzcommon.h              |    2 -
 src/lib/lib.pro                     |  129 ++++++++++++++++++++++++++++++-----
 src/lib/preferences/preferences.cpp |    2 -
 src/lib/tools/qztools.cpp           |    4 +
 src/main/main.cpp                   |    4 +
 src/main/main.pro                   |    7 +-
 11 files changed, 170 insertions(+), 48 deletions(-)
 create mode 100644 src/config.h

diff --git a/falkon.pro b/falkon.pro
index fc6ab748..c4ef882c 100644
--- a/falkon.pro
+++ b/falkon.pro
@@ -6,16 +6,16 @@
 #
 #-------------------------------------------------
 
-lessThan(QT_VERSION, 5.8) {
-    error("Falkon requires at least Qt 5.8!")
-}
-
-lessThan(QT.webengine.VERSION, 5.8) {
-    error("Falkon requires at least QtWebEngine 5.8!")
-}
+#lessThan(QT_VERSION, 5.8) {
+#    error("Falkon requires at least Qt 5.8!")
+#}
+#
+#lessThan(QT.webengine.VERSION, 5.8) {
+#    error("Falkon requires at least QtWebEngine 5.8!")
+#}
 
 # Create plugins directory first on Mac / Linux
-mac|unix: system(test -d bin/plugins || mkdir bin/plugins)
+#mac|unix: system(test -d bin/plugins || mkdir bin/plugins)
 
 TEMPLATE = subdirs
 
@@ -25,10 +25,10 @@ src_lib.target = sub-src-lib
 src_main.subdir = src/main
 src_main.depends = sub-src-lib
 
-src_plugins.subdir = src/plugins
-src_plugins.depends = sub-src-lib
+#src_plugins.subdir = src/plugins
+#src_plugins.depends = sub-src-lib
 
-SUBDIRS += src_lib src_main src_plugins
+SUBDIRS += src_lib src_main #src_plugins
 
 mac: {
     macdeploysh.target = bundle
diff --git a/src/config.h b/src/config.h
new file mode 100644
index 00000000..c8a7b991
--- /dev/null
+++ b/src/config.h
@@ -0,0 +1,11 @@
+/* config.h.  Generated by cmake from config.h.cmake  */
+
+#define FALKON_VERSION "3.1.0"
+#define FALKON_PLUGIN_PATH "/usr/local/lib/x86_64-linux-gnu/plugins/falkon"
+#define FALKON_GIT_REVISION "e9a52810"
+
+/* Enable portable build */
+/* #undef PORTABLE_BUILD */
+
+/* Disable DBus support */
+/* #undef DISABLE_DBUS */
diff --git a/src/defines.pri b/src/defines.pri
index c26a24e8..552c0251 100644
--- a/src/defines.pri
+++ b/src/defines.pri
@@ -1,25 +1,32 @@
-DESTDIR = $$PWD/../bin
+#DESTDIR = $$PWD/../bin
+#QZ_DESTDIR = $$DESTDIR
+#OBJECTS_DIR = $$PWD/../build
+#MOC_DIR = $$PWD/../build
+#RCC_DIR = $$PWD/../build
+#UI_DIR = $$PWD/../build
+
+DESTDIR = $$OUT_PWD/../..
 QZ_DESTDIR = $$DESTDIR
-OBJECTS_DIR = $$PWD/../build
-MOC_DIR = $$PWD/../build
-RCC_DIR = $$PWD/../build
-UI_DIR = $$PWD/../build
+#OBJECTS_DIR = .
+#MOC_DIR = .
+#RCC_DIR = .
+#UI_DIR = .
 
 # workaround for #849: see https://bugreports.qt-project.org/browse/QTBUG-23196
 mocinclude.CONFIG *= fix_target
 
-QZ_VERSION = 2.1.99
+QZ_VERSION = 3.1.0
 unix: VERSION = $$QZ_VERSION
 DEFINES *= FALKON_VERSION=\\\"""$$QZ_VERSION"\\\""
 
 d_no_system_datapath = $$(NO_SYSTEM_DATAPATH)
 d_kde_integration = $$(KDE_INTEGRATION)
 d_gnome_integration = $$(GNOME_INTEGRATION)
-d_nox11 = $$(NO_X11)
+d_nox11 = "true"
 d_portable = $$(PORTABLE_BUILD)
 d_nonblock_dialogs = $$(NONBLOCK_JS_DIALOGS)
 d_use_lib_path = $$(USE_LIBPATH)
-d_disable_dbus = $$(DISABLE_DBUS)
+d_disable_dbus = "true"
 d_disable_updates_check = $$(DISABLE_UPDATES_CHECK)
 d_debug_build = $$(DEBUG_BUILD)
 d_prefix = $$(FALKON_PREFIX)
diff --git a/src/lib/app/commandlineoptions.cpp b/src/lib/app/commandlineoptions.cpp
index e09847ad..0205bcb6 100644
--- a/src/lib/app/commandlineoptions.cpp
+++ b/src/lib/app/commandlineoptions.cpp
@@ -105,11 +105,11 @@ void CommandLineOptions::parseActions()
     if (parser.isSet(helpOption)) {
         parser.showHelp();
     }
-
+#if 0
     if (parser.isSet(versionOption)) {
         parser.showVersion();
     }
-
+#endif
     if (parser.isSet(authorsOption)) {
         std::cout << "David Rosca <nowrep@gmail.com>" << std::endl;
 
diff --git a/src/lib/app/mainapplication.cpp b/src/lib/app/mainapplication.cpp
index 1e89d169..7c709833 100644
--- a/src/lib/app/mainapplication.cpp
+++ b/src/lib/app/mainapplication.cpp
@@ -252,7 +252,7 @@ MainApplication::MainApplication(int &argc, char** argv)
     if (messages.isEmpty()) {
         messages.append(QStringLiteral(" "));
     }
-
+#if 0
     if (isRunning()) {
         m_isClosing = true;
         foreach (const QString &message, messages) {
@@ -260,6 +260,7 @@ MainApplication::MainApplication(int &argc, char** argv)
         }
         return;
     }
+#endif
 
 #ifdef Q_OS_MACOS
     setQuitOnLastWindowClosed(false);
@@ -676,9 +677,9 @@ void MainApplication::startPrivateBrowsing(const QUrl &startUrl)
         args << url.toEncoded();
     }
 
-    if (!QProcess::startDetached(applicationFilePath(), args)) {
+    //if (!QProcess::startDetached(applicationFilePath(), args)) {
         qWarning() << "MainApplication: Cannot start new browser process for private browsing!" << applicationFilePath() << args;
-    }
+    //}
 }
 
 void MainApplication::reloadUserStyleSheet()
@@ -935,11 +936,12 @@ void MainApplication::loadSettings()
     webSettings->setAttribute(QWebEngineSettings::XSSAuditingEnabled, settings.value(QSL("XSSAuditing"), false).toBool());
     webSettings->setAttribute(QWebEngineSettings::PrintElementBackgrounds, settings.value(QSL("PrintElementBackground"), true).toBool());
     webSettings->setAttribute(QWebEngineSettings::SpatialNavigationEnabled, settings.value(QSL("SpatialNavigation"), false).toBool());
-    webSettings->setAttribute(QWebEngineSettings::ScrollAnimatorEnabled, settings.value(QSL("AnimateScrolling"), true).toBool());
+    webSettings->setAttribute(QWebEngineSettings::ScrollAnimatorEnabled, settings.value(QSL("AnimateScrolling"), false).toBool());
     webSettings->setAttribute(QWebEngineSettings::HyperlinkAuditingEnabled, false);
     webSettings->setAttribute(QWebEngineSettings::FullScreenSupportEnabled, true);
     webSettings->setAttribute(QWebEngineSettings::LocalContentCanAccessRemoteUrls, true);
     webSettings->setAttribute(QWebEngineSettings::FocusOnNavigationEnabled, false);
+    webSettings->setAttribute(QWebEngineSettings::Accelerated2dCanvasEnabled, false);
 
 #if QTWEBENGINEWIDGETS_VERSION >= QT_VERSION_CHECK(5, 10, 0)
     webSettings->setAttribute(QWebEngineSettings::AllowWindowActivationFromJavaScript, settings.value(QSL("allowJavaScriptActivateWindow"), false).toBool());
diff --git a/src/lib/app/qzcommon.h b/src/lib/app/qzcommon.h
index 92a453c5..c7aed1e3 100644
--- a/src/lib/app/qzcommon.h
+++ b/src/lib/app/qzcommon.h
@@ -118,7 +118,7 @@ Q_DECLARE_OPERATORS_FOR_FLAGS(Qz::NewTabPositionFlags)
 #elif defined(Q_OS_MACOS)
 #define DEFAULT_THEME_NAME QSL("mac")
 #elif defined(Q_OS_UNIX)
-#define DEFAULT_THEME_NAME QSL("linux")
+#define DEFAULT_THEME_NAME QSL("chrome")
 #else
 #define DEFAULT_THEME_NAME QSL("default")
 #endif
diff --git a/src/lib/lib.pro b/src/lib/lib.pro
index 52de094a..951562d1 100644
--- a/src/lib/lib.pro
+++ b/src/lib/lib.pro
@@ -1,4 +1,4 @@
-QT += webenginecore webenginewidgets webchannel network widgets sql quickwidgets printsupport
+QT += webengine webenginecore webenginewidgets webchannel network widgets sql quickwidgets printsupport
 
 TARGET = Falkon
 TEMPLATE = lib
@@ -8,12 +8,12 @@ DEFINES *= FALKON_SHAREDLIBRARY
 CONFIG += c++14
 
 include(../defines.pri)
-include(../../translations/translations.pri)
+#include(../../translations/translations.pri)
 include(3rdparty/qtsingleapplication/qtsingleapplication.pri)
 
 CONFIG(debug, debug|release): include(../../tests/modeltest/modeltest.pri)
 
-unix:!contains(DEFINES, "DISABLE_DBUS") QT += dbus
+#unix:!contains(DEFINES, "DISABLE_DBUS") QT += dbus
 
 INCLUDEPATH += 3rdparty \
                adblock \
@@ -54,6 +54,7 @@ SOURCES += \
     adblock/adblockicon.cpp \
     adblock/adblockmanager.cpp \
     adblock/adblockmatcher.cpp \
+    adblock/adblockplugin.cpp \
     adblock/adblockrule.cpp \
     adblock/adblocksearchtree.cpp \
     adblock/adblocksubscription.cpp \
@@ -103,6 +104,7 @@ SOURCES += \
     downloads/downloaditem.cpp \
     downloads/downloadmanager.cpp \
     downloads/downloadoptionsdialog.cpp \
+    downloads/downloadsbutton.cpp \
     history/history.cpp \
     history/historyitem.cpp \
     history/historymanager.cpp \
@@ -119,13 +121,15 @@ SOURCES += \
     navigation/locationbar.cpp \
     navigation/locationbarpopup.cpp \
     navigation/navigationbar.cpp \
+    navigation/navigationbarconfigdialog.cpp \
+    navigation/navigationbartoolbutton.cpp \
     navigation/navigationcontainer.cpp \
     navigation/reloadstopbutton.cpp \
     navigation/siteicon.cpp \
     navigation/websearchbar.cpp \
     network/networkmanager.cpp \
-    network/networkproxyfactory.cpp \
     network/networkurlinterceptor.cpp \
+    network/schemehandlers/extensionschemehandler.cpp \
     network/schemehandlers/falkonschemehandler.cpp \
     network/sslerrordialog.cpp \
     notifications/desktopnotification.cpp \
@@ -142,15 +146,54 @@ SOURCES += \
     other/checkboxdialog.cpp \
     other/iconchooser.cpp \
     other/licenseviewer.cpp \
+    other/protocolhandlerdialog.cpp \
+    other/protocolhandlermanager.cpp \
     other/qzsettings.cpp \
     other/siteinfo.cpp \
     other/siteinfowidget.cpp \
-    other/statusbarmessage.cpp \
+    other/statusbar.cpp \
     other/updater.cpp \
     other/useragentmanager.cpp \
     plugins/pluginproxy.cpp \
     plugins/plugins.cpp \
     plugins/speeddial.cpp \
+    plugins/qml/qmlpluginloader.cpp \
+    plugins/qml/qmlplugin.cpp \
+    plugins/qml/qmlplugins.cpp \
+    plugins/qml/qmlplugininterface.cpp \
+    plugins/qml/qmlengine.cpp \
+    plugins/qml/qmlstaticdata.cpp \
+    plugins/qml/api/bookmarks/qmlbookmarktreenode.cpp \
+    plugins/qml/api/bookmarks/qmlbookmarks.cpp \
+    plugins/qml/api/topsites/qmlmostvisitedurl.cpp \
+    plugins/qml/api/topsites/qmltopsites.cpp \
+    plugins/qml/api/history/qmlhistoryitem.cpp \
+    plugins/qml/api/history/qmlhistory.cpp \
+    plugins/qml/api/cookies/qmlcookie.cpp \
+    plugins/qml/api/cookies/qmlcookies.cpp \
+    plugins/qml/api/tabs/qmltab.cpp \
+    plugins/qml/api/tabs/qmltabs.cpp \
+    plugins/qml/api/notifications/qmlnotifications.cpp \
+    plugins/qml/api/clipboard/qmlclipboard.cpp \
+    plugins/qml/api/windows/qmlwindow.cpp \
+    plugins/qml/api/windows/qmlwindows.cpp \
+    plugins/qml/api/browseraction/qmlbrowseraction.cpp \
+    plugins/qml/api/sidebar/qmlsidebar.cpp \
+    plugins/qml/api/menus/qmlmenu.cpp \
+    plugins/qml/api/menus/qmlaction.cpp \
+    plugins/qml/api/menus/qmlwebhittestresult.cpp \
+    plugins/qml/api/settings/qmlsettings.cpp \
+    plugins/qml/api/events/qmlqzobjects.cpp \
+    plugins/qml/api/events/qmlmouseevent.cpp \
+    plugins/qml/api/events/qmlwheelevent.cpp \
+    plugins/qml/api/events/qmlkeyevent.cpp \
+    plugins/qml/api/userscript/qmluserscript.cpp \
+    plugins/qml/api/userscript/qmluserscripts.cpp \
+    plugins/qml/api/userscript/qmlexternaljsobject.cpp \
+    plugins/qml/api/extensionscheme/qmlextensionscheme.cpp \
+    plugins/qml/api/extensionscheme/qmlwebengineurlrequestjob.cpp \
+    plugins/qml/api/fileutils/qmlfileutils.cpp \
+    plugins/qml/api/qmlenums.cpp \
     popupwindow/popuplocationbar.cpp \
     popupwindow/popupstatusbarmessage.cpp \
     popupwindow/popupwebview.cpp \
@@ -172,23 +215,27 @@ SOURCES += \
     sidebar/sidebar.cpp \
     tabwidget/combotabbar.cpp \
     tabwidget/tabbar.cpp \
+    tabwidget/tabcontextmenu.cpp \
     tabwidget/tabicon.cpp \
+    tabwidget/tabmodel.cpp \
+    tabwidget/tabmrumodel.cpp \
     tabwidget/tabstackedwidget.cpp \
+    tabwidget/tabtreemodel.cpp \
     tabwidget/tabwidget.cpp \
+    tools/abstractbuttoninterface.cpp \
     tools/aesinterface.cpp \
     tools/animatedwidget.cpp \
-    tools/buttonbox.cpp \
     tools/buttonwithmenu.cpp \
     tools/certificateinfowidget.cpp \
     tools/clickablelabel.cpp \
+    tools/closedwindowsmanager.cpp \
     tools/closedtabsmanager.cpp \
     tools/colors.cpp \
     tools/delayedfilewatcher.cpp \
+    tools/desktopfile.cpp \
     tools/docktitlebarwidget.cpp \
-    tools/emptynetworkreply.cpp \
     tools/enhancedmenu.cpp \
     tools/focusselectlineedit.cpp \
-    tools/frame.cpp \
     tools/headerview.cpp \
     tools/horizontallistwidget.cpp \
     tools/html5permissions/html5permissionsdialog.cpp \
@@ -200,14 +247,12 @@ SOURCES += \
     tools/menubar.cpp \
     tools/pagethumbnailer.cpp \
     tools/progressbar.cpp \
-    tools/qzregexp.cpp \
     tools/qztools.cpp \
     tools/removeitemfocusdelegate.cpp \
     tools/scripts.cpp \
     tools/sqldatabase.cpp \
     tools/toolbutton.cpp \
     tools/treewidget.cpp \
-    tools/widget.cpp \
     tools/wheelhelper.cpp \
     webengine/javascript/autofilljsobject.cpp \
     webengine/javascript/externaljsobject.cpp \
@@ -235,6 +280,7 @@ HEADERS  += \
     adblock/adblockicon.h \
     adblock/adblockmanager.h \
     adblock/adblockmatcher.h \
+    adblock/adblockplugin.h \
     adblock/adblockrule.h \
     adblock/adblocksearchtree.h \
     adblock/adblocksubscription.h \
@@ -284,6 +330,7 @@ HEADERS  += \
     downloads/downloaditem.h \
     downloads/downloadmanager.h \
     downloads/downloadoptionsdialog.h \
+    downloads/downloadsbutton.h \
     history/history.h \
     history/historyitem.h \
     history/historymanager.h \
@@ -300,13 +347,15 @@ HEADERS  += \
     navigation/locationbar.h \
     navigation/locationbarpopup.h \
     navigation/navigationbar.h \
+    navigation/navigationbarconfigdialog.h \
+    navigation/navigationbartoolbutton.h \
     navigation/navigationcontainer.h \
     navigation/reloadstopbutton.h \
     navigation/siteicon.h \
     navigation/websearchbar.h \
     network/networkmanager.h \
-    network/networkproxyfactory.h \
     network/networkurlinterceptor.h \
+    network/schemehandlers/extensionschemehandler.h \
     network/schemehandlers/falkonschemehandler.h \
     network/urlinterceptor.h \
     network/sslerrordialog.h \
@@ -324,16 +373,55 @@ HEADERS  += \
     other/checkboxdialog.h \
     other/iconchooser.h \
     other/licenseviewer.h \
+    other/protocolhandlerdialog.h \
+    other/protocolhandlermanager.h \
     other/qzsettings.h \
     other/siteinfo.h \
     other/siteinfowidget.h \
-    other/statusbarmessage.h \
+    other/statusbar.h \
     other/updater.h \
     other/useragentmanager.h \
     plugins/plugininterface.h \
     plugins/pluginproxy.h \
     plugins/plugins.h \
     plugins/speeddial.h \
+    plugins/qml/qmlpluginloader.h \
+    plugins/qml/qmlplugin.h \
+    plugins/qml/qmlplugins.h \
+    plugins/qml/qmlplugininterface.h \
+    plugins/qml/qmlengine.h \
+    plugins/qml/qmlstaticdata.h \
+    plugins/qml/api/bookmarks/qmlbookmarktreenode.h \
+    plugins/qml/api/bookmarks/qmlbookmarks.h \
+    plugins/qml/api/topsites/qmlmostvisitedurl.h \
+    plugins/qml/api/topsites/qmltopsites.h \
+    plugins/qml/api/history/qmlhistoryitem.h \
+    plugins/qml/api/history/qmlhistory.h \
+    plugins/qml/api/cookies/qmlcookie.h \
+    plugins/qml/api/cookies/qmlcookies.h \
+    plugins/qml/api/tabs/qmltab.h \
+    plugins/qml/api/tabs/qmltabs.h \
+    plugins/qml/api/notifications/qmlnotifications.h \
+    plugins/qml/api/clipboard/qmlclipboard.h \
+    plugins/qml/api/windows/qmlwindow.h \
+    plugins/qml/api/windows/qmlwindows.h \
+    plugins/qml/api/browseraction/qmlbrowseraction.h \
+    plugins/qml/api/sidebar/qmlsidebar.h \
+    plugins/qml/api/menus/qmlmenu.h \
+    plugins/qml/api/menus/qmlaction.h \
+    plugins/qml/api/menus/qmlwebhittestresult.h \
+    plugins/qml/api/settings/qmlsettings.h \
+    plugins/qml/api/events/qmlqzobjects.h \
+    plugins/qml/api/events/qmlmouseevent.h \
+    plugins/qml/api/events/qmlwheelevent.h \
+    plugins/qml/api/events/qmlkeyevent.h \
+    plugins/qml/api/userscript/qmluserscript.h \
+    plugins/qml/api/userscript/qmluserscripts.h \
+    plugins/qml/api/userscript/qmlexternaljsobject.h \
+    plugins/qml/api/extensionscheme/qmlextensionscheme.h \
+    plugins/qml/api/extensionscheme/qmlwebengineurlrequestjob.h \
+    plugins/qml/api/fileutils/qmlfileutils.h \
+    plugins/qml/api/qmlenums.h \
     popupwindow/popuplocationbar.h \
     popupwindow/popupstatusbarmessage.h \
     popupwindow/popupwebview.h \
@@ -356,23 +444,27 @@ HEADERS  += \
     sidebar/sidebarinterface.h \
     tabwidget/combotabbar.h \
     tabwidget/tabbar.h \
+    tabwidget/tabcontextmenu.h \
     tabwidget/tabicon.h \
+    tabwidget/tabmodel.h \
+    tabwidget/tabmrumodel.h \
     tabwidget/tabstackedwidget.h \
+    tabwidget/tabtreemodel.h \
     tabwidget/tabwidget.h \
+    tools/abstractbuttoninterface.h \
     tools/aesinterface.h \
     tools/animatedwidget.h \
-    tools/buttonbox.h \
     tools/buttonwithmenu.h \
     tools/certificateinfowidget.h \
     tools/clickablelabel.h \
+    tools/closedwindowsmanager.h \
     tools/closedtabsmanager.h \
     tools/colors.h \
     tools/delayedfilewatcher.h \
+    tools/desktopfile.h \
     tools/docktitlebarwidget.h \
-    tools/emptynetworkreply.h \
     tools/enhancedmenu.h \
     tools/focusselectlineedit.h \
-    tools/frame.h \
     tools/headerview.h \
     tools/horizontallistwidget.h \
     tools/html5permissions/html5permissionsdialog.h \
@@ -384,14 +476,12 @@ HEADERS  += \
     tools/menubar.h \
     tools/pagethumbnailer.h \
     tools/progressbar.h \
-    tools/qzregexp.h \
     tools/qztools.h \
     tools/removeitemfocusdelegate.h \
     tools/scripts.h \
     tools/sqldatabase.h \
     tools/toolbutton.h \
     tools/treewidget.h \
-    tools/widget.h \
     tools/wheelhelper.h \
     webengine/javascript/autofilljsobject.h \
     webengine/javascript/externaljsobject.h \
@@ -421,6 +511,7 @@ FORMS    += \
     downloads/downloadmanager.ui \
     downloads/downloadoptionsdialog.ui \
     history/historymanager.ui \
+    navigation/navigationbarconfigdialog.ui \
     network/sslerrordialog.ui \
     notifications/desktopnotification.ui \
     opensearch/editsearchengine.ui \
@@ -429,6 +520,7 @@ FORMS    += \
     other/browsinglibrary.ui \
     other/clearprivatedata.ui \
     other/iconchooser.ui \
+    other/protocolhandlerdialog.ui \
     other/siteinfo.ui \
     other/siteinfowidget.ui \
     preferences/acceptlanguage.ui \
@@ -452,12 +544,13 @@ FORMS    += \
     webtab/searchtoolbar.ui \
 
 RESOURCES += \
+	adblock/adblock.qrc \
     data/data.qrc \
     data/html.qrc \
     data/icons.qrc \
     data/breeze-fallback.qrc
 
-!mac:unix {
+!mac:!genode:unix {
     target.path = $$library_folder
 
     INSTALLS += target
diff --git a/src/lib/preferences/preferences.cpp b/src/lib/preferences/preferences.cpp
index 24841b74..bec230ca 100644
--- a/src/lib/preferences/preferences.cpp
+++ b/src/lib/preferences/preferences.cpp
@@ -286,7 +286,7 @@ Preferences::Preferences(BrowserWindow* window)
     ui->allowJavaScript->setChecked(settings.value("allowJavaScript", true).toBool());
     ui->linksInFocusChain->setChecked(settings.value("IncludeLinkInFocusChain", false).toBool());
     ui->spatialNavigation->setChecked(settings.value("SpatialNavigation", false).toBool());
-    ui->animateScrolling->setChecked(settings.value("AnimateScrolling", true).toBool());
+    ui->animateScrolling->setChecked(settings.value("AnimateScrolling", false).toBool());
     ui->wheelScroll->setValue(settings.value("wheelScrollLines", qApp->wheelScrollLines()).toInt());
     ui->xssAuditing->setChecked(settings.value("XSSAuditing", false).toBool());
     ui->printEBackground->setChecked(settings.value("PrintElementBackground", true).toBool());
diff --git a/src/lib/tools/qztools.cpp b/src/lib/tools/qztools.cpp
index 499b2250..746e3e2f 100644
--- a/src/lib/tools/qztools.cpp
+++ b/src/lib/tools/qztools.cpp
@@ -841,6 +841,7 @@ QStringList QzTools::splitCommandArguments(const QString &command)
 
 bool QzTools::startExternalProcess(const QString &executable, const QString &args)
 {
+#if 0
     const QStringList arguments = splitCommandArguments(args);
 
     bool success = QProcess::startDetached(executable, arguments);
@@ -855,6 +856,9 @@ bool QzTools::startExternalProcess(const QString &executable, const QString &arg
     }
 
     return success;
+#else
+	return false;
+#endif
 }
 
 void QzTools::setWmClass(const QString &name, const QWidget* widget)
diff --git a/src/main/main.cpp b/src/main/main.cpp
index c1af1b6f..14ac8564 100644
--- a/src/main/main.cpp
+++ b/src/main/main.cpp
@@ -22,6 +22,7 @@
 #include <QMessageBox> // For QT_REQUIRE_VERSION
 #include <iostream>
 
+#if 0
 #if defined(Q_OS_LINUX) || defined(__GLIBC__) || defined(__FreeBSD__) || defined(__HAIKU__)
 #include <signal.h>
 #include <execinfo.h>
@@ -94,6 +95,7 @@ void falkon_signal_handler(int s)
     std::cout << "Backtrace successfully saved in " << qPrintable(dir.absoluteFilePath(file.fileName())) << std::endl;
 }
 #endif // defined(Q_OS_LINUX) || defined(__GLIBC__) || defined(__FreeBSD__)
+#endif
 
 #ifndef Q_OS_WIN
 void msgHandler(QtMsgType type, const QMessageLogContext &context, const QString &msg)
@@ -129,8 +131,10 @@ int main(int argc, char* argv[])
     qInstallMessageHandler(&msgHandler);
 #endif
 
+#if 0
 #if defined(Q_OS_LINUX) || defined(__GLIBC__) || defined(__FreeBSD__)
     signal(SIGSEGV, falkon_signal_handler);
+#endif
 #endif
 
     // Hack to fix QT_STYLE_OVERRIDE with QProxyStyle
diff --git a/src/main/main.pro b/src/main/main.pro
index ee9ae20b..53bb11aa 100644
--- a/src/main/main.pro
+++ b/src/main/main.pro
@@ -1,6 +1,6 @@
 include(../defines.pri)
 
-QT += webenginecore webenginewidgets network widgets sql
+QT += webengine webenginecore webenginewidgets network widgets sql
 
 TARGET = falkon
 mac: TARGET = Falkon
@@ -12,10 +12,11 @@ LIBS += $$QZ_DESTDIR/libFalkon.la
 }
 else {
 !unix|mac: LIBS += -L$$QZ_DESTDIR -lFalkon
-!mac:unix: LIBS += $$QZ_DESTDIR/libFalkon.so
+!mac:!genode:unix: LIBS += $$QZ_DESTDIR/libFalkon.so
+genode: LIBS += $$QZ_DESTDIR/libFalkon.lib.so
 }
 
-unix:!contains(DEFINES, "DISABLE_DBUS") QT += dbus
+#unix:!contains(DEFINES, "DISABLE_DBUS") QT += dbus
 
 INCLUDEPATH += ../lib/3rdparty \
                ../lib/app \
